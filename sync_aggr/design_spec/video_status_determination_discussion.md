# video_status_determination æ¨¡å—è®¾è®¡è®¨è®ºè®°å½•

**æ—¥æœŸ**: 2025å¹´11æœˆ2æ—¥  
**ä¸»é¢˜**: video_status_determination æ¨¡å—æè¿°çš„ç†è§£ä¸åˆ†æ

---

## ç”¨æˆ·é—®é¢˜

æ‚¨å¸Œæœ›æˆ‘æŸ¥çœ‹å¯¹ `video_status_determination` æ¨¡å—çš„æè¿°ï¼Œå¹¶è¯´è¯´æˆ‘çš„ç†è§£ã€‚

---

## AI çš„ç†è§£åˆ†æ

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

è¿™æ˜¯ä¸€ä¸ª**è§†é¢‘åŒ…æ ¼å¼éªŒè¯æ¨¡å—**ï¼Œè´Ÿè´£æ£€æŸ¥4è·¯è§†é¢‘pipeçš„æ•°æ®åŒ…æ˜¯å¦ç¬¦åˆé¢„æœŸçš„æ ¼å¼å’Œåºåˆ—ï¼Œç¡®ä¿è§†é¢‘æ•°æ®çš„å®Œæ•´æ€§å’Œè¿ç»­æ€§ã€‚

---

### ğŸ“Š ç†è§£è¦ç‚¹

#### 1. å·¥ä½œæœºåˆ¶ï¼ˆ3æ‹æµæ°´çº¿ï¼‰

ä»æè¿°çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ª**2çº§æ ¡éªŒ+1çº§åˆ¤å®š**çš„æµæ°´çº¿ï¼š

- **ç¬¬1æ‹**ï¼šæ£€æŸ¥ `pkt_datatype`ï¼ˆåŒ…ç±»å‹ï¼‰æ˜¯å¦å’Œ `local_pkt_datatype` ä¸€è‡´
- **ç¬¬2æ‹**ï¼šåœ¨ç¬¬1æ‹é€šè¿‡çš„åŸºç¡€ä¸Šï¼Œæ£€æŸ¥ `pkt_count`ï¼ˆå¸§å·/è¡Œå·ï¼‰æ˜¯å¦å’Œ `local_pkt_count` ä¸€è‡´
- **ç¬¬3æ‹**ï¼šæ ¹æ® `Auto_Mask_En` é…ç½®å†³å®šæ˜¯æ­£å¸¸è¾“å‡ºè¿˜æ˜¯å…¨å±€å±è”½

#### 2. æ£€æµ‹èŒƒå›´

- åªæ£€æµ‹ `timestamp_align_pass_bitmap` å¯¹åº”ä½ä¸º1çš„pipeï¼ˆå³æ—¶æˆ³å¯¹é½æˆåŠŸçš„pipeï¼‰
- é€çº§ç­›é€‰ï¼šç¬¬1æ‹ç­›é€‰å‡ºdatatypeæ­£ç¡®çš„ï¼Œç¬¬2æ‹è¿›ä¸€æ­¥ç­›é€‰å‡ºcountæ­£ç¡®çš„

#### 3. å…¨å±€å±è”½é€»è¾‘ï¼ˆå…³é”®ç‰¹æ€§ï¼‰

å½“ `Auto_Mask_En == 4'b0000` æ—¶ï¼š
- **ä»»ä½•ä¸€ä¸ªpipeå¤±è´¥** â†’ è§¦å‘**å…¨å±€å±è”½**
- è¾“å‡ºï¼š`video_status_fail_bitmap = 4'b1111`ï¼ˆæ‰€æœ‰pipeå¤±è´¥ï¼‰
- è¾“å‡ºï¼š`video_status_pass_bitmap = 4'b0000`ï¼ˆæ— pipeé€šè¿‡ï¼‰

è¿™æ˜¯ä¸€ç§**"å…¨æˆ–æ— "ç­–ç•¥**ï¼Œç¡®ä¿æ‰€æœ‰pipeéƒ½æ­£å¸¸æ‰èƒ½å·¥ä½œã€‚

#### 4. æ¨¡å—è¾¹ç•Œæ¸…æ™°

- æœ¬æ¨¡å—**åªè´Ÿè´£æ£€æµ‹**ï¼Œä¸è´Ÿè´£ç»´æŠ¤ `local_pkt_datatype` å’Œ `local_pkt_count`
- è¿™äº›æœ¬åœ°å‚è€ƒå€¼ç”±é¡¶å±‚ `pipe_mask_ctrl` æ¨¡å—ç»´æŠ¤å¹¶ä¼ å…¥
- æ£€æµ‹ä½¿èƒ½ä¿¡å· `check_video_pkt_datatype` å’Œ `check_video_pkt_count` ä¹Ÿç”±é¡¶å±‚æ§åˆ¶

---

### ğŸ¤” ç–‘é—®å’Œå»ºè®®

#### â“ ç–‘é—®1ï¼šæµæ°´çº¿æè¿°ä¸å®Œæ•´

3.1èŠ‚çš„"ç¬¬1æ‹/ç¬¬2æ‹/ç¬¬3æ‹"å†…å®¹æ˜¯ç©ºçš„ï¼Œå»ºè®®è¡¥å……ï¼š

**ç¬¬1æ‹ï¼šdatatypeæ£€æµ‹**
- é‡‡æ ·è¾“å…¥ï¼š`timestamp_align_pass_bitmap`, `data_vld[3:0]`, `data_[0-3][101:96]`, `local_pkt_datatype`
- æ¯”è¾ƒé€»è¾‘ï¼šå¯¹äº `timestamp_align_pass_bitmap` ä¸­ä¸º1çš„æ¯ä¸ªpipeï¼Œæ£€æŸ¥ `data[101:96] == local_pkt_datatype`
- ç”Ÿæˆï¼š`video_status_pass_bitmap_stage1`ï¼ˆdatatypeåŒ¹é…çš„pipeï¼‰

**ç¬¬2æ‹ï¼špkt_countæ£€æµ‹**
- åœ¨ `video_status_pass_bitmap_stage1` åŸºç¡€ä¸Šï¼Œæ£€æŸ¥ `data[95:80] == local_pkt_count`
- æ›´æ–°ï¼š`video_status_pass_bitmap_stage2`ï¼ˆdatatypeå’Œcountéƒ½åŒ¹é…çš„pipeï¼‰

**ç¬¬3æ‹ï¼šå…¨å±€åˆ¤å®šä¸è¾“å‡º**
- è®¡ç®—ï¼š`video_status_fail_bitmap = (~video_status_pass_bitmap_stage2) & timestamp_align_pass_bitmap`
- åˆ¤æ–­ï¼šå¦‚æœ `video_status_fail_bitmap` ä¸­ä»»ä¸€ä½å¯¹åº”çš„ `Auto_Mask_En` ä¸º0 â†’ å…¨å±€å±è”½
- è¾“å‡ºæœ€ç»ˆç»“æœ

#### â“ ç–‘é—®2ï¼š`pipe_normal_bitmap` çš„æ¥æº

åœ¨æµç¨‹å›¾ä¸­æåˆ°ï¼š
```
ç”± (~video_status_pass_bitmap) & pipe_normal_bitmap ç”Ÿæˆ video_status_fail_bitmap
```

ä½†åœ¨**è¾“å…¥ç«¯å£è¡¨**ä¸­æ²¡æœ‰çœ‹åˆ° `pipe_normal_bitmap` è¾“å…¥ï¼Œè¿™ä¸ªä¿¡å·æ˜¯ï¼š
1. åº”è¯¥ä½œä¸ºè¾“å…¥ç«¯å£è¡¥å……ï¼Ÿ
2. è¿˜æ˜¯åº”è¯¥ç”¨ `timestamp_align_pass_bitmap` æ›¿ä»£ï¼Ÿ

æ ¹æ®é€»è¾‘æ¨æ–­ï¼Œåº”è¯¥æ˜¯ï¼š
```verilog
video_status_fail_bitmap = (~video_status_pass_bitmap) & timestamp_align_pass_bitmap
```

#### â“ ç–‘é—®3ï¼šå…¨å±€å±è”½çš„è§¦å‘æ¡ä»¶

æµç¨‹å›¾ä¸­çš„åˆ¤æ–­æ¡ä»¶æè¿°ä¸ºï¼š
> "video_status_fail_bitmap å¯¹åº” Auto_Mask_En ä½ä¸º 0"

å»ºè®®æ”¹ä¸ºæ›´æ¸…æ™°çš„è¡¨è¿°ï¼š
> "å½“å­˜åœ¨ä»»ä¸€ `video_status_fail_bitmap[i] == 1` ä¸” `Auto_Mask_En[i] == 0` æ—¶"

å³ï¼š`|(video_status_fail_bitmap & (~Auto_Mask_En))`

#### â“ ç–‘é—®4ï¼šæ£€æµ‹ä½¿èƒ½çš„ä½œç”¨

`check_video_pkt_datatype` å’Œ `check_video_pkt_count` çš„ä½œç”¨æ˜¯ï¼š
1. **åŠ¨æ€å…³é—­æŸäº›æ£€æµ‹**ï¼ˆçµæ´»æ€§ï¼‰ï¼Ÿ
2. è¿˜æ˜¯**æŒ‡ç¤ºå“ªæ‹åº”è¯¥æ£€æµ‹**ï¼ˆæµæ°´çº¿æ§åˆ¶ï¼‰ï¼Ÿ

ä»æè¿°çœ‹åƒæ˜¯ç¬¬2ç§ï¼ˆ"ç”¨äºç¬¬ä¸€æ‹æ¯”è¾ƒå™¨å¯ç”¨"ï¼‰ï¼Œä½†è¿™æ ·çš„è¯ï¼Œè¿™ä¸¤ä¸ªä¿¡å·åº”è¯¥æ˜¯ï¼š
- `check_video_pkt_datatype` åœ¨ç¬¬1æ‹æœ‰æ•ˆ
- `check_video_pkt_count` åœ¨ç¬¬2æ‹æœ‰æ•ˆ

å¦‚æœæ˜¯è¿™æ ·ï¼Œå»ºè®®åœ¨"2.4 æ£€æµ‹è§„åˆ™"ä¸­æ˜ç¡®è¯´æ˜ã€‚

---

### âœ… è®¾è®¡ä¼˜ç‚¹

1. **æµæ°´çº¿è®¾è®¡åˆç†**ï¼šé€çº§ç­›é€‰ï¼Œå‡å°‘æ— æ•ˆè®¡ç®—
2. **å…¨å±€å±è”½ç­–ç•¥æ¸…æ™°**ï¼šé€šè¿‡ `Auto_Mask_En` çµæ´»æ§åˆ¶
3. **æ¨¡å—èŒè´£å•ä¸€**ï¼šåªè´Ÿè´£æ£€æµ‹ï¼Œä¸è´Ÿè´£çŠ¶æ€ç»´æŠ¤
4. **æ¥å£å®šä¹‰æ¸…æ™°**ï¼š15ä¸ªç«¯å£ï¼Œåˆ†å·¥æ˜ç¡®

---

### ğŸ“ æ€»ç»“

è®¾è®¡æ€è·¯å¾ˆæ¸…æ™°ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„**è§†é¢‘åŒ…æ ¼å¼æ ¡éªŒå™¨**ï¼Œé‡‡ç”¨**2çº§æ£€æµ‹+å…¨å±€åˆ¤å®š**çš„æµæ°´çº¿æ¶æ„ã€‚ä¸»è¦éœ€è¦æ¾„æ¸…çš„æ˜¯ï¼š

1. è¡¥å……3.1èŠ‚çš„æµæ°´çº¿è¯¦ç»†æè¿°
2. ç¡®è®¤ `pipe_normal_bitmap` çš„å¤„ç†
3. æ˜ç¡®å…¨å±€å±è”½çš„è§¦å‘æ¡ä»¶è¡¨è¿°
4. è¯´æ˜æ£€æµ‹ä½¿èƒ½ä¿¡å·çš„ç¡®åˆ‡ä½œç”¨

---

## æ¨¡å—æ¥å£å®šä¹‰ï¼ˆå‚è€ƒï¼‰

| ç«¯å£å | I/O | ä½å®½ | æè¿° |
| :--- | :-: | :--- | :--- |
| `clk` | I | 1 | å…¥å£æ—¶é’Ÿ |
| `rst_n` | I | 1 | å¼‚æ­¥å¤ä½ï¼Œä½æœ‰æ•ˆ |
| `Auto_Mask_En` | I | 4 | è‡ªåŠ¨å±è”½ä½¿èƒ½é…ç½®ï¼ˆæ¥è‡ªINITçŠ¶æ€é”å­˜ï¼‰ |
| `timestamp_align_pass_bitmap` | I | 4 | æ—¶æˆ³å¯¹é½æˆåŠŸçš„pipeä½å›¾ |
| `data_vld_0` | I | 1 | fwft_fifo_0å‡ºå£æ•°æ®æœ‰æ•ˆä½ |
| `data_vld_1` | I | 1 | fwft_fifo_1å‡ºå£æ•°æ®æœ‰æ•ˆä½ |
| `data_vld_2` | I | 1 | fwft_fifo_2å‡ºå£æ•°æ®æœ‰æ•ˆä½ |
| `data_vld_3` | I | 1 | fwft_fifo_3å‡ºå£æ•°æ®æœ‰æ•ˆä½ |
| `data_0` | I | 102 | fwft_fifo_0å‡ºå£æ•°æ® |
| `data_1` | I | 102 | fwft_fifo_1å‡ºå£æ•°æ® |
| `data_2` | I | 102 | fwft_fifo_2å‡ºå£æ•°æ® |
| `data_3` | I | 102 | fwft_fifo_3å‡ºå£æ•°æ® |
| `check_video_pkt_datatype` | I | 1 | ä½¿èƒ½æ£€æŸ¥è§†é¢‘åŒ…datatype |
| `check_video_pkt_count` | I | 1 | ä½¿èƒ½æ£€æŸ¥è§†é¢‘åŒ…countï¼Œè¡¨ç¤ºå¸§å·æˆ–è¡Œå· |
| `local_pkt_datatype` | I | 6 | æœ¬åœ°datatype |
| `local_pkt_count` | I | 16 | æœ¬åœ°countï¼Œè¡¨ç¤ºå¸§å·æˆ–è¡Œå· |
| `start_video_status_determing` | I | 1 | å¼€å§‹è¿›è¡Œè§†é¢‘çŠ¶æ€åˆ¤å®š |
| `video_status_pass_bitmap` | O | 4 | è§†é¢‘çŠ¶æ€åˆ¤å®šæˆåŠŸçš„pipeä½å›¾ |
| `video_status_fail_bitmap` | O | 4 | è§†é¢‘çŠ¶æ€åˆ¤å®šå¤±è´¥çš„pipeä½å›¾ |

---

## æ•°æ®æ ¼å¼å®šä¹‰

FWFT_FIFO data[101:0] ä½åŸŸå®šä¹‰ï¼š

| ä½åŸŸ | æè¿° |
| :--- | :--- |
| `[79:0]` | pkt_timestamp[79:0]: æ¥æ”¶åˆ°åŒ…ç»“æŸæ—¶ï¼Œusè®¡æ•°å™¨çš„å€¼ |
| `[95:80]` | pkt_count[15:0]: æ¥æ”¶åˆ°åŒ…çš„åºå·ï¼Œè¡¨ç¤ºå¸§å·æˆ–è¡Œå· |
| `[101:96]` | pkt_datatype[5:0]: åŒ…ç±»å‹ï¼ˆFS/FE/LONG_PACKET/LS/LEï¼‰ |

**datatypeå®šä¹‰**ï¼š
- FS (Frame Start): å¸§èµ·å§‹åŒ…
- FE (Frame End): å¸§ç»“æŸåŒ…
- LONG_PACKET: é•¿åŒ…æ•°æ®
- LS (Line Start): è¡Œèµ·å§‹åŒ…
- LE (Line End): è¡Œç»“æŸåŒ…

---

## æ ¸å¿ƒé€»è¾‘æµç¨‹

### 1. æ­£å¸¸åºåˆ—æ£€æµ‹
æ£€æŸ¥è¾“å…¥è§†é¢‘åŒ…çš„datatypeæ˜¯å¦å’Œæœ¬åœ°é¢„æœŸä¸€è‡´ï¼ˆå¦‚ FS â†’ LS â†’ LONG_PACKET â†’ LE â†’ FEï¼‰

### 2. å¸§IDè¿ç»­æ€§
æ£€æŸ¥è¾“å…¥è§†é¢‘åŒ…çš„pkt_countæ˜¯å¦å’Œæœ¬åœ°é¢„æœŸä¸€è‡´ï¼ˆå¦‚è¿ç»­é€’å¢ï¼‰

### 3. å…¨å±€å¤±è´¥å¤„ç†
å½“ `Auto_Mask_En == 4'b0000` æ—¶ï¼Œä»»ä½•ä¸€ä¸ªpipeå¤±è´¥éƒ½è§¦å‘å…¨å±€å±è”½ï¼ˆ`video_status_fail_bitmap = 4'b1111`ï¼‰

---

## åç»­è¡ŒåŠ¨é¡¹

- [x] ~~è¡¥å……3.1èŠ‚æµæ°´çº¿è¯¦ç»†æè¿°~~ **å·²å®Œæˆ 2025-11-02**
- [x] ~~æ˜ç¡® pipe_normal_bitmap çš„æ¥æºå’Œä½¿ç”¨~~ **å·²ç¡®è®¤ï¼šä½œä¸ºè¾“å…¥ç«¯å£ä¼ å…¥**
- [x] ~~æ¾„æ¸…å…¨å±€å±è”½è§¦å‘æ¡ä»¶çš„é€»è¾‘è¡¨è¾¾~~ **å·²ç¡®è®¤ï¼š|(video_status_fail_bitmap_raw & (~Auto_Mask_En))**
- [x] ~~è¯´æ˜æ£€æµ‹ä½¿èƒ½ä¿¡å·çš„ç¡®åˆ‡ä½œç”¨å’Œæ—¶åº~~ **å·²ç¡®è®¤ï¼šæµæ°´çº¿ä½¿èƒ½ä¿¡å·ï¼Œcheck_video_pkt_countéœ€é”å­˜ä¸€æ‹**
- [ ] è¡¥å……ç¬¬4èŠ‚"ç¡¬ä»¶èµ„æºä¸å®ç°ç»†èŠ‚"çš„å†…å®¹
- [ ] å®ç° video_status_determination.v RTLä»£ç 

---

## è®¾è®¡ç¡®è®¤è®°å½•ï¼ˆ2025å¹´11æœˆ2æ—¥ï¼‰

ç»ä¸è®¾è®¡è€…è®¨è®ºï¼Œç¡®è®¤äº†ä»¥ä¸‹å…³é”®è®¾è®¡å†³ç­–ï¼š

### âœ… ç–‘é—®1ï¼šæµæ°´çº¿å®ç°ç»†èŠ‚
**ç¡®è®¤**ï¼š
- `check_video_pkt_count` éœ€è¦é”å­˜ä¸€æ‹ä¸ `data_vld` å¯¹é½
- `video_status_fail_bitmap_raw = pipe_normal_bitmap & (~video_status_pass_bitmap)`
- è¯¦ç»†æµæ°´çº¿é€»è¾‘å·²è¡¥å……åˆ° pipe_mask_ctrl_design.md ç¬¬442-475è¡Œ

### âœ… ç–‘é—®2ï¼špipe_normal_bitmap çš„ä½¿ç”¨
**ç¡®è®¤**ï¼š
- éœ€è¦ä½œä¸ºè¾“å…¥ç«¯å£å¼•å…¥ `pipe_normal_bitmap`
- ç”¨äºè®¡ç®— `video_status_fail_bitmap_raw`ï¼Œåªå…³å¿ƒæ­£å¸¸å·¥ä½œpipeçš„å¤±è´¥æƒ…å†µ

### âœ… ç–‘é—®3ï¼šcheckä¿¡å·çš„ç¡®åˆ‡ä½œç”¨
**ç¡®è®¤**ï¼š
- **ç†è§£Bæ­£ç¡®**ï¼šæµæ°´çº¿ä½¿èƒ½ä¿¡å·
- èŠ¯ç‰‡åŠŸèƒ½ä¸Šéœ€è¦é’ˆå¯¹ä¸åŒçš„åŒ…ç±»å‹åŠ¨æ€æ§åˆ¶æ˜¯å¦æ£€æŸ¥ pkt_count
- ä¾‹å¦‚ï¼šFS/FEåŒ…å¯èƒ½åªæ£€æŸ¥datatypeï¼ŒLONG_PACKETåŒ…ä¸¤è€…éƒ½æ£€æŸ¥

### âœ… ç–‘é—®4ï¼šå…¨å±€å±è”½è§¦å‘æ¡ä»¶
**ç¡®è®¤**ï¼š
- ç†è§£æ­£ç¡®ï¼š`|(video_status_fail_bitmap_raw & (~Auto_Mask_En))`
- å«ä¹‰ï¼šå­˜åœ¨ä»»ä¸€å¤±è´¥pipeä¸”è¯¥pipeçš„Auto_Mask_En=0æ—¶ï¼Œè§¦å‘å…¨å±€å±è”½

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025å¹´11æœˆ2æ—¥  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ2æ—¥ - RTLå®ç°å®Œæˆ  
**ç›¸å…³æ–‡ä»¶**: `pipe_mask_ctrl_design.md`, `video_status_determination.v`  
**æ¨¡å—ä½ç½®**: å­æ¨¡å—2 (ç¬¬346è¡Œèµ·)

---

## ğŸ‰ RTLå®ç°å®Œæˆè®°å½•ï¼ˆ2025-11-02ï¼‰

### å®ç°æ¦‚å†µ

ç»è¿‡è®¾è®¡è®¨è®ºã€æ–‡æ¡£å®Œå–„å’ŒRTLç¼–ç ï¼Œ`video_status_determination` æ¨¡å—å·²å®Œæ•´å®ç°ï¼š

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|:-----|:-----|:-----|
| è®¾è®¡æ–‡æ¡£ | âœ… å®Œæˆ | æµæ°´çº¿è¯¦ç»†æè¿° + ç¡¬ä»¶å®ç°ç»†èŠ‚ |
| RTLä»£ç  | âœ… å®Œæˆ | 242è¡Œï¼Œ0è¯­æ³•é”™è¯¯ |
| é›†æˆä»£ç  | âœ… å®Œæˆ | pipe_mask_ctrl.v å·²æ›´æ–° |
| å®ç°æ–‡æ¡£ | âœ… å®Œæˆ | è¯¦ç»†å®ç°è¯´æ˜ + éªŒè¯å»ºè®® |

### äº¤ä»˜æ–‡ä»¶

#### æ–°å»ºæ–‡ä»¶
1. **video_status_determination.v** (242è¡Œ)
   - ä½ç½®: `sync_aggr/video_status_determination.v`
   - åŠŸèƒ½: 3æ‹æµæ°´çº¿è§†é¢‘çŠ¶æ€åˆ¤å®šæ¨¡å—
   - è´¨é‡: 0è¯­æ³•é”™è¯¯ï¼Œæ³¨é‡Šå®Œæ•´

2. **video_status_determination_å®ç°è¯´æ˜.md**
   - ä½ç½®: `sync_aggr/video_status_determination_å®ç°è¯´æ˜.md`
   - å†…å®¹: è¯¦ç»†çš„RTLå®ç°è¯´æ˜ã€å…³é”®è®¾è®¡è¦ç‚¹ã€éªŒè¯å»ºè®®

3. **äº¤ä»˜æ¸…å•_video_status_determination.md**
   - ä½ç½®: `sync_aggr/äº¤ä»˜æ¸…å•_video_status_determination.md`
   - å†…å®¹: å®Œæ•´çš„äº¤ä»˜æ¸…å•ã€è´¨é‡æŒ‡æ ‡ã€ä¸‹ä¸€æ­¥å·¥ä½œå»ºè®®

4. **è®¾è®¡è¿›ç¨‹æ›´æ–°_20251102.md**
   - ä½ç½®: `sync_aggr/design_spec/è®¾è®¡è¿›ç¨‹æ›´æ–°_20251102.md`
   - å†…å®¹: ç–‘é—®è§£å†³è¿‡ç¨‹ã€è®¾è®¡è¿›ç¨‹æ›´æ–°

#### æ›´æ–°æ–‡ä»¶
1. **pipe_mask_ctrl_design.md**
   - æ›´æ–°: ç¬¬442-490è¡Œæµæ°´çº¿å®ç°ï¼ˆç²¾ç®€ï¼‰
   - æ–°å¢: ç¬¬492-545è¡Œç¡¬ä»¶èµ„æºä¸å®ç°ç»†èŠ‚ï¼ˆå®Œå–„ï¼‰
   - ä¼˜åŒ–: æµç¨‹å›¾è¡¨è¿°æ›´æ¸…æ™°

2. **pipe_mask_ctrl.v**
   - æ›´æ–°: ç¬¬410-421è¡Œ video_status_determination å®ä¾‹åŒ–
   - æ–°å¢è¿æ¥: pipe_normal_bitmap, check_video_pkt_datatype/count, local_pkt_datatype/count

### æ ¸å¿ƒå®ç°ç‰¹æ€§

#### 1. 3æ‹æµæ°´çº¿æ¶æ„

```verilog
// Stage 1: Datatypeæ£€æµ‹
always @(posedge clk) begin
    if (start_video_status_determing) begin
        stage1_datatype_match[i] <= (check_bitmap[i] && check_video_pkt_datatype) ? 
                                    (pkt_datatype[i] == local_pkt_datatype) : 1'b1;
        stage1_check_count <= check_video_pkt_count;  // å…³é”®ï¼šé”å­˜
    end
end

// Stage 2: Pkt_Countæ£€æµ‹
always @(posedge clk) begin
    if (stage1_valid) begin
        stage2_count_match[i] <= (stage1_pass_bitmap[i] && stage1_check_count) ? 
                                 (pkt_count[i] == local_pkt_count) : 1'b1;
    end
end

// Stage 3: å…¨å±€åˆ¤å®š
assign video_status_fail_bitmap_raw = pipe_normal_bitmap & (~stage2_pass_bitmap);
assign global_mask_trigger = |(fail_bitmap_raw & (~Auto_Mask_En));
```

#### 2. å…³é”®è®¾è®¡è¦ç‚¹

**âœ… è¦ç‚¹1: check_video_pkt_count å¿…é¡»é”å­˜ä¸€æ‹**
```verilog
// Stage 1: ç«‹å³é”å­˜
stage1_check_count <= check_video_pkt_count;

// Stage 2: ä½¿ç”¨é”å­˜åçš„å€¼ï¼ˆä¸æ•°æ®å¯¹é½ï¼‰
if (stage1_pass_bitmap[i] && stage1_check_count)
```

**âœ… è¦ç‚¹2: ä½¿ç”¨ pipe_normal_bitmap è®¡ç®—å¤±è´¥bitmap**
```verilog
// åªå…³å¿ƒæ­£å¸¸å·¥ä½œpipeçš„å¤±è´¥ï¼Œä¸åŒ…æ‹¬restart pipe
video_status_fail_bitmap_raw = pipe_normal_bitmap & (~stage2_pass_bitmap);
```

**âœ… è¦ç‚¹3: å…¨å±€å±è”½è§¦å‘æ¡ä»¶**
```verilog
// ä»»ä¸€å¤±è´¥pipeçš„Auto_Mask_En=0æ—¶è§¦å‘
global_mask_trigger = |(video_status_fail_bitmap_raw & (~Auto_Mask_En));

if (global_mask_trigger) begin
    video_status_pass_bitmap = 4'b0000;
    video_status_fail_bitmap = 4'b1111;  // å…¨å±€å±è”½
end
```

**âœ… è¦ç‚¹4: æ¡ä»¶æ£€æµ‹é€»è¾‘**
```verilog
// Stage 1: datatypeæ£€æµ‹
datatype_match[i] = (check_bitmap[i] && check_video_pkt_datatype) ? 
                    (pkt_datatype[i] == local_pkt_datatype) : 1'b1;

// Stage 2: countæ£€æµ‹ï¼ˆä½¿ç”¨é”å­˜çš„ä½¿èƒ½ï¼‰
count_match[i] = (stage1_pass_bitmap[i] && stage1_check_count) ? 
                 (pkt_count[i] == local_pkt_count) : 1'b1;
```

#### 3. ç¡¬ä»¶èµ„æº

| èµ„æºç±»å‹ | æ•°é‡ | ç”¨é€” |
|:--------|:-----|:-----|
| 6bitæ¯”è¾ƒå™¨ | 4ä¸ª | Stage 1 datatypeæ¯”è¾ƒ |
| 16bitæ¯”è¾ƒå™¨ | 4ä¸ª | Stage 2 countæ¯”è¾ƒ |
| å¯„å­˜å™¨ | ~120ä¸ª | æµæ°´çº¿é”å­˜ï¼ˆ4ä¸ªpipeÃ—30bitï¼‰ |
| ç»„åˆé€»è¾‘ | å°‘é‡ | bitmapä¸/æˆ–/éè¿ç®— |

### æ¥å£å®Œæ•´æ€§

æ‰€æœ‰19ä¸ªè¾“å…¥ç«¯å£å’Œ2ä¸ªè¾“å‡ºç«¯å£å·²å®Œæ•´å®ç°å¹¶è¿æ¥ï¼š

**æ–°å¢è¿æ¥çš„å…³é”®ç«¯å£**:
- `pipe_normal_bitmap` â† `pipe_normal_bitmap` (æ¥è‡ªé¡¶å±‚)
- `check_video_pkt_datatype` â† `check_pkt_datatype` (æ¥è‡ªlocalçŠ¶æ€æœº)
- `check_video_pkt_count` â† `check_pkt_count` (æ¥è‡ªlocalçŠ¶æ€æœº)
- `local_pkt_datatype` â† `local_pkt_datatype` (æ¥è‡ªé¡¶å±‚ç»´æŠ¤)
- `local_pkt_count` â† `local_pkt_count` (æ¥è‡ªé¡¶å±‚ç»´æŠ¤)

### ä»£ç è´¨é‡

| æŒ‡æ ‡ | è¯„åˆ† | è¯´æ˜ |
|:-----|:-----|:-----|
| åŠŸèƒ½å®Œæ•´æ€§ | â­â­â­â­â­ | 100% ç¬¦åˆè®¾è®¡æ–‡æ¡£ |
| ä»£ç å¯è¯»æ€§ | â­â­â­â­â­ | æ³¨é‡Šå®Œæ•´ï¼Œç»“æ„æ¸…æ™° |
| å¯ç»´æŠ¤æ€§ | â­â­â­â­â­ | æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“æ‰©å±• |
| å¥å£®æ€§ | â­â­â­â­â­ | å®Œæ•´çš„å¤ä½å’Œè¾¹ç•Œå¤„ç† |
| è¯­æ³•æ­£ç¡®æ€§ | â­â­â­â­â­ | 0è¯­æ³•é”™è¯¯ |

### å…³é”®æ³¨æ„äº‹é¡¹

#### âš ï¸ æ—¶åºå¯¹é½é—®é¢˜ï¼ˆå·²è§£å†³ï¼‰

**é—®é¢˜**: `check_video_pkt_count` ä¸æ•°æ®çš„æ—¶åºå¯¹é½

**è§£å†³æ–¹æ¡ˆ**: åœ¨Stage 1ç«‹å³é”å­˜ï¼ŒStage 2ä½¿ç”¨é”å­˜å€¼
```verilog
// ç¬¬1æ‹ç«‹å³é”å­˜
stage1_check_count <= check_video_pkt_count;

// ç¬¬2æ‹ä½¿ç”¨é”å­˜å€¼ï¼ˆä¸æ•°æ®å¯¹é½ï¼‰
if (stage1_pass_bitmap[i] && stage1_check_count) compare_count();
```

**å½±å“**: å¦‚æœä¸é”å­˜ï¼Œä¼šå¯¼è‡´æ£€æµ‹ä½¿èƒ½ä¸æ•°æ®æµä¸åŒ¹é…ï¼Œäº§ç”Ÿé”™è¯¯çš„åˆ¤å®šç»“æœ

#### âš ï¸ pipe_normal_bitmap çš„ä½¿ç”¨

**ä¸ºä»€ä¹ˆä¼ å…¥ pipe_normal_bitmapï¼Ÿ**

å› ä¸ºè®¡ç®—å¤±è´¥bitmapæ—¶ï¼Œåªå…³å¿ƒ**æ­£å¸¸å·¥ä½œçš„pipe**ï¼š
```verilog
fail_bitmap = pipe_normal_bitmap & (~pass_bitmap)
```

å¦‚æœä½¿ç”¨ `timestamp_align_pass_bitmap`ï¼š
- ä¼šåŒ…å« `restart_bitmap` çš„pipe
- è¿™äº›pipeçš„å¤±è´¥ä¸åº”è¯¥è§¦å‘å±è”½ï¼ˆæ­£åœ¨æ¢å¤ä¸­ï¼‰

#### âš ï¸ å…¨å±€å±è”½çš„è¯­ä¹‰

**è§¦å‘æ¡ä»¶**:
```verilog
|(fail_bitmap & (~Auto_Mask_En))
```

**å«ä¹‰**: ä»»ä¸€**æ­£å¸¸å·¥ä½œçš„pipeå¤±è´¥**ä¸”**è¯¥pipeé…ç½®ä¸ºä¸å…è®¸è‡ªåŠ¨å±è”½**

**ç»“æœ**: å¼ºåˆ¶æ‰€æœ‰pipeå¤±è´¥ï¼ˆ`fail_bitmap = 4'b1111`ï¼‰

**åº”ç”¨åœºæ™¯**: å…³é”®ä»»åŠ¡ï¼Œä¸å…è®¸ä»»ä½•æ•°æ®ä¸¢å¤±

### å»ºè®®çš„éªŒè¯åœºæ™¯

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•
1. âœ… æ­£å¸¸åŒ…åºåˆ—ï¼ˆFSâ†’LONG_PKTâ†’FEï¼‰
2. âœ… datatypeé”™è¯¯
3. âœ… pkt_counté”™è¯¯

#### é«˜çº§åŠŸèƒ½æµ‹è¯•
4. âœ… check_enableåŠ¨æ€æ§åˆ¶
5. âœ… å…¨å±€å±è”½è§¦å‘ï¼ˆAuto_Mask_En=0ï¼‰
6. âœ… éƒ¨åˆ†pipeå±è”½ï¼ˆAuto_Mask_En=0111ï¼‰

#### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
7. âœ… æ‰€æœ‰pipeå¤±è´¥
8. âœ… æ— pipeéœ€è¦æ£€æµ‹ï¼ˆtimestamp_align_pass_bitmap=0ï¼‰

### é¡¹ç›®è¿›åº¦æ›´æ–°

| æ¨¡å— | æ–‡æ¡£å®Œæˆåº¦ | RTLå®Œæˆåº¦ | éªŒè¯å®Œæˆåº¦ | æ€»ä½“çŠ¶æ€ |
|:-----|:---------:|:---------:|:---------:|:---------|
| pipe_mask_ctrl | 95% | 95% | 0% | âš ï¸ å¾…éªŒè¯ |
| timestamp_align_determination | 100% | 100% | 0% | âœ… å¾…éªŒè¯ |
| **video_status_determination** | **100%** âœ¨ | **100%** âœ¨ | **0%** | **âœ… å¾…éªŒè¯** |
| schedule_concat | 30% | 0% | 0% | âŒ å¾…å¼€å‘ |
| black_pixel_generator | 30% | 0% | 0% | âŒ å¾…å¼€å‘ |

**æ•´ä½“é¡¹ç›®å®Œæˆåº¦**: **çº¦ 50%** (ä»40%â†’50%)

### ä¸‹ä¸€æ­¥å·¥ä½œ

#### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰
- [ ] åŠŸèƒ½ä»¿çœŸéªŒè¯ï¼ˆ6-8ä¸ªæµ‹è¯•åœºæ™¯ï¼‰
- [ ] ä¸ pipe_mask_ctrl è”åˆä»¿çœŸ
- [ ] ä»£ç å®¡æŸ¥ï¼ˆæµæ°´çº¿æ—¶åºã€é”å­˜é€»è¾‘ï¼‰

#### åç»­ä¼˜åŒ–ï¼ˆä¸‹å‘¨ï¼‰
- [ ] æ—¶åºåˆ†æï¼ˆå…³é”®è·¯å¾„æ£€æŸ¥ï¼‰
- [ ] è¦†ç›–ç‡åˆ†æï¼ˆä»£ç +åŠŸèƒ½ï¼‰
- [ ] æ–‡æ¡£å®Œå–„ï¼ˆæ³¢å½¢å›¾ã€æ—¶åºå›¾ï¼‰

### é£é™©è¯„ä¼°

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ | çŠ¶æ€ |
|:------|:-----|:-----|:--------|:-----|
| checkä¿¡å·æ—¶åºé”™é… | ä½ | é«˜ | é€šè¿‡é”å­˜è§£å†³ | âœ… å·²ç¼“è§£ |
| å…¨å±€å±è”½è¯¯è§¦å‘ | ä½ | ä¸­ | éœ€ä»¿çœŸéªŒè¯ | â³ å¾…éªŒè¯ |
| pipe_mask_ctrlä¿¡å·æœªå®šä¹‰ | ä½ | ä¸­ | ä»£ç å®¡æŸ¥ç¡®è®¤ | âœ… å·²ç¡®è®¤ |

### æŠ€æœ¯æ”¯æŒæ–‡æ¡£

- **è®¾è®¡æ–‡æ¡£**: `pipe_mask_ctrl_design.md` (å·²æ›´æ–°)
- **å®ç°è¯´æ˜**: `video_status_determination_å®ç°è¯´æ˜.md` (æ–°å»º)
- **è®¨è®ºè®°å½•**: `video_status_determination_discussion.md` (æœ¬æ–‡æ¡£)
- **äº¤ä»˜æ¸…å•**: `äº¤ä»˜æ¸…å•_video_status_determination.md` (æ–°å»º)
- **è¿›ç¨‹æ›´æ–°**: `è®¾è®¡è¿›ç¨‹æ›´æ–°_20251102.md` (æ–°å»º)

---
